<!DOCTYPE html>
<html>
<head>
	<title>Progressbar Demo</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" type="text/css" href="assets/bootstrap.css">
	<script type="text/javascript" src="assets/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="assets/bootstrap.js"></script>
	<script type="text/javascript" src="assets/knockout-2.3.0.js"></script>
	<script type="text/javascript" src="assets/bootstrap-progressbar.js"></script>
</head>

<body>
<div class="container">
	<h2>进度条示例</h2>
	<div>
		<div id="progressbar" style="position: relative;"></div>
		<span data-bind="text: formattedPercent()" class="pull-right badge">100%</span>
	</div>

	<label>最大值</label><input type="text" data-bind="value: maximum, enable: !isRunning()" class="input-mini">
	<label>递增值</label><input type="text" data-bind="value: step, enable: !isRunning()" class="input-mini">
	<label>位置</label><input type="text" data-bind="value: position, enable: !isRunning()" class="input-mini">
	<div class="pull-right">
		<input type="button" class="btn btn-primary" value="单步" data-bind="click: stepIt, enable: !isRunning()">
		<input type="button" class="btn btn-primary" value="重置" data-bind="click: reset, enable: !isRunning()">
		<input type="button" class="btn btn-primary" value="开始" data-bind="click: start, enable: !isRunning()">
	</div>
</div>

<script type="text/javascript">
	$(function () {
		$('#progressbar').progressbar({
			minimum: 10,
			barLength: 3			
		});
		$('#progressbar').on("positionChanged", function (e) {
			viewModel.percent(e.percent);
		});
		ko.applyBindings(viewModel);
	});

	var viewModel = {
		percent: ko.observable(0),
		step: ko.observable(20),
		maximum: ko.observable(100),
		position: ko.observable(0),
		interval: undefined,
		isRunning: ko.observable(false),

		stepIt: function () {
			$('#progressbar').progressbar('stepIt');
		},

		reset: function () {
			$('#progressbar').progressbar('reset');
		},

		start: function () {
			if (this.isRunning())
				return;
			this.reset();
			this.isRunning(true);

			var self = this;
			debugger
			this.interval = setInterval(function () {
				$('#progressbar').progressbar('stepIt');
				if (self.percent() >= 100) {
					clearInterval(self.interval);
					self.interval = undefined;
					self.isRunning(false);
				}
			}, 250);
		}
	};

	viewModel.formattedPercent = ko.computed(function () {
		return this.percent() + '%';
	}, viewModel);

	viewModel.maximum.subscribe(function (newValue) {
		$('#progressbar').progressbar('setMaximum', newValue);
	}, viewModel);

	viewModel.position.subscribe(function (newValue) {
		$('#progressbar').progressbar('setPosition', newValue);
	}, viewModel);

	viewModel.step.subscribe(function (newValue) {
		$('#progressbar').progressbar('setStep', newValue);
	}, viewModel);
</script>
</body>
</html>
